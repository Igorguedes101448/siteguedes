<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Notifica√ß√µes - ChefGuedes</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <a href="../index.html">ChefGuedes</a>
            </div>
            <ul class="nav-menu">
                <li><a href="../index.html">Home</a></li>
                <li><a href="explorar-receitas.html">Explorar Receitas</a></li>
                <li id="authMenuItems"></li>
            </ul>
            <div id="notificationDropdown" class="notification-dropdown" style="display: none;">
                <button class="notification-btn" onclick="toggleNotifications()">
                    üîî
                    <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
                </button>
                <div id="notificationMenu" class="notification-menu">
                    <div class="notification-header">
                        <h4>Notifica√ß√µes</h4>
                        <button onclick="markAllRead()" style="background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 0.9rem;">Marcar todas como lidas</button>
                    </div>
                    <div id="notificationList" class="notification-list">
                        <p style="text-align: center; color: var(--text-secondary); padding: 20px;">Sem notifica√ß√µes</p>
                    </div>
                </div>
            </div>
            <div id="profileDropdown" class="profile-dropdown" style="display: none;">
                <button class="profile-btn" onclick="toggleProfileMenu()">
                    <img id="profileImage" src="" alt="Perfil" class="profile-image">
                    <span id="profileName"></span>
                </button>
                <div id="profileMenu" class="profile-menu">
                    <a href="perfil.html">Meu Perfil</a>
                    <a href="dashboard.html">Dashboard</a>
                    <a href="#" onclick="logout(); return false;">Sair</a>
                </div>
            </div>
        </div>
    </nav>

    <main class="container">
        <div class="page-header">
            <h1>üß™ Teste de Notifica√ß√µes</h1>
            <p>Crie notifica√ß√µes de teste para verificar o sistema</p>
        </div>

        <div class="dashboard-card">
            <h3>Criar Notifica√ß√£o de Teste</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">Esta p√°gina permite criar notifica√ß√µes para testar o sistema.</p>

            <div style="display: grid; gap: 15px; max-width: 600px;">
                <button class="btn btn-primary" onclick="createTestNotification('friend_request')">
                    üë• Pedido de Amizade
                </button>
                <button class="btn btn-secondary" onclick="createTestNotification('group_invite')">
                    üë™ Convite para Grupo
                </button>
                <button class="btn btn-success" onclick="createTestNotification('recipe_share')">
                    üçΩÔ∏è Receita Partilhada
                </button>
                <button class="btn btn-warning" onclick="createTestNotification('comment')">
                    üí¨ Novo Coment√°rio
                </button>
                <button class="btn btn-danger" onclick="createTestNotification('like')">
                    ‚ù§Ô∏è Nova Curtida
                </button>
                <button class="btn btn-outline" onclick="createTestNotification('system')">
                    üîî Notifica√ß√£o do Sistema
                </button>
            </div>

            <hr style="margin: 30px 0; border: none; border-top: 1px solid var(--border-color);">

            <div style="display: flex; gap: 10px;">
                <button class="btn btn-info" onclick="loadNotifications()">
                    üîÑ Atualizar Notifica√ß√µes
                </button>
                <button class="btn btn-outline" onclick="markAllRead()">
                    ‚úÖ Marcar Todas como Lidas
                </button>
            </div>
        </div>

        <div class="dashboard-card">
            <h3>üìã Informa√ß√µes</h3>
            <ul style="line-height: 2; color: var(--text-secondary);">
                <li>Clique num bot√£o para criar uma notifica√ß√£o de teste</li>
                <li>A notifica√ß√£o aparecer√° no √≠cone üîî no menu superior</li>
                <li>As notifica√ß√µes atualizam automaticamente a cada 30 segundos</li>
                <li>Clique numa notifica√ß√£o para marc√°-la como lida</li>
                <li>Use "Marcar todas como lidas" para limpar todas</li>
            </ul>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 ChefGuedes. Todos os direitos reservados.</p>
    </footer>

    <script src="../js/auth-api.js"></script>
    <script src="../js/main-api.js"></script>
    <script>
        // Verificar autentica√ß√£o
        (async function() {
            await requireAuth();
        })();

        async function createTestNotification(type) {
            const messages = {
                'friend_request': {
                    title: 'Novo Pedido de Amizade',
                    message: 'Jo√£o Silva enviou-lhe um pedido de amizade.',
                    link: 'perfil.html'
                },
                'group_invite': {
                    title: 'Convite para Grupo',
                    message: 'Maria Santos convidou-o para o grupo "Receitas da Av√≥".',
                    link: 'grupos.html'
                },
                'recipe_share': {
                    title: 'Receita Partilhada',
                    message: 'Ana Rodrigues partilhou a receita "Bacalhau √† Br√°s" consigo.',
                    link: 'explorar-receitas.html'
                },
                'comment': {
                    title: 'Novo Coment√°rio',
                    message: 'Pedro Costa comentou na sua receita "Pastel de Nata".',
                    link: 'explorar-receitas.html'
                },
                'like': {
                    title: 'Nova Curtida',
                    message: 'Teresa Lopes gostou da sua receita "Francesinha".',
                    link: 'explorar-receitas.html'
                },
                'system': {
                    title: 'Bem-vindo ao ChefGuedes!',
                    message: 'Explore receitas, crie grupos e partilhe as suas cria√ß√µes culin√°rias.',
                    link: 'dashboard.html'
                }
            };

            const notif = messages[type];

            try {
                // Obter utilizador atual
                const user = await getCurrentUser();

                const response = await fetch(`${API_BASE}/notifications.php`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'create',
                        sessionToken: getSessionToken(),
                        targetUserId: user.id,
                        type: type,
                        title: notif.title,
                        message: notif.message,
                        link: notif.link
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Notifica√ß√£o de teste criada! Clique no sino üîî para ver.');
                    // Recarregar notifica√ß√µes
                    setTimeout(() => {
                        loadNotifications();
                    }, 500);
                } else {
                    showError(result.message || 'Erro ao criar notifica√ß√£o.');
                }
            } catch (error) {
                console.error('Erro:', error);
                showError('Erro ao criar notifica√ß√£o de teste.');
            }
        }
    </script>
</body>
</html>
